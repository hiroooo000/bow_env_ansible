---
# bash on ubuntu on windows environment
- hosts: localhost
  tasks:
    - name: be sure apt sources.list
      become: yes
      copy: src=./files/sources.list dest=/etc/apt/sources.list backup=yes

    - name: be sure packages are installed
      become: yes
      apt:  name={{ item }}  state=latest update_cache=yes cache_valid_time=86400
      with_items:
      - global
      - expect
      - tmux
      - unzip
      - python-pip
  
    - name: be sure .vim/plugin dir is existed
      file:
        path: ~/.vim/plugin
        state: directory

    - name: global gtags.vim
      copy:
        src: /usr/share/doc/global/examples/gtags.vim.gz
        dest: ~/.vim/plugin
    
    - command: gunzip ~/.vim/plugin/gtags.vim.gz creates=~/.vim/plugin/gtags.vim

    - name: be sure .tmux.conf is deployed.
      copy: 
        src: files/.tmux.conf
        dest: ~/.tmux.conf

    - name: setting ps1
      lineinfile:
        dest: ~/.bashrc
        regexp: "export PS1="
        line: 'export PS1="[\w]\n\\$ "'

    - name: add docker repo key
      become: yes
      apt_key:
        url: https://apt.dockerproject.org/gpg

    - name: ensure docker's apt repository exists
      become: true
      apt_repository:
        repo:  deb https://apt.dockerproject.org/repo ubuntu-trusty main
        filename: docker.list

    - name: ensure docker is installed
      become: true
      apt: 
        name: docker-engine
        state: latest
        update_cache: yes 
        cache_valid_time: 86400

    - name: ensure docker-compose is installed
      become: true
      pip:
        name: docker-compose
        state: latest

    - name: setting export DOCKER_HOST
      lineinfile:
        dest: ~/.bashrc
        regexp: "export DOCKER_HOST="
        line: 'export DOCKER_HOST=tcp://localhost:2375'
